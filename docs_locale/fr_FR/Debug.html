<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 8.6.9" />
<title>Debug / Troubleshooting / Investigations</title>
<style type="text/css">
/* Shared CSS for AsciiDoc xhtml11 and html5 backends */

/* Default font. */
body {
  font-family: Georgia,serif;
}

/* Title font. */
h1, h2, h3, h4, h5, h6,
div.title, caption.title,
thead, p.table.header,
#toctitle,
#author, #revnumber, #revdate, #revremark,
#footer {
  font-family: Arial,Helvetica,sans-serif;
}

body {
  margin: 1em 5% 1em 5%;
}

a {
  color: blue;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
  color: navy;
}

strong {
  font-weight: bold;
  color: #083194;
}

h1, h2, h3, h4, h5, h6 {
  color: #527bbd;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1, h2, h3 {
  border-bottom: 2px solid silver;
}
h2 {
  padding-top: 0.5em;
}
h3 {
  float: left;
}
h3 + * {
  clear: left;
}
h5 {
  font-size: 1.0em;
}

div.sectionbody {
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

ul, ol, li > p {
  margin-top: 0;
}
ul > li     { color: #aaa; }
ul > li > * { color: black; }

.monospaced, code, pre {
  font-family: "Courier New", Courier, monospace;
  font-size: inherit;
  color: navy;
  padding: 0;
  margin: 0;
}
pre {
  white-space: pre-wrap;
}

#author {
  color: #527bbd;
  font-weight: bold;
  font-size: 1.1em;
}
#email {
}
#revnumber, #revdate, #revremark {
}

#footer {
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
#footer-text {
  float: left;
  padding-bottom: 0.5em;
}
#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

#preamble {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.0em;
  margin-bottom: 2.0em;
  margin-right: 10%;
  color: #606060;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #527bbd;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid #dddddd;
  border-left: 4px solid #f0f0f0;
  padding: 0.5em;
}

div.listingblock > div.content {
  border: 1px solid #dddddd;
  border-left: 5px solid #f0f0f0;
  background: #f8f8f8;
  padding: 0.5em;
}

div.quoteblock, div.verseblock {
  padding-left: 1.0em;
  margin-left: 1.0em;
  margin-right: 10%;
  border-left: 5px solid #f0f0f0;
  color: #888;
}

div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock > pre.content {
  font-family: inherit;
  font-size: inherit;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #527bbd;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 3px solid #dddddd;
}

div.exampleblock > div.content {
  border-left: 3px solid #dddddd;
  padding-left: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
span.image img { border-style: none; vertical-align: text-bottom; }
a.image:visited { color: white; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
  color: navy;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
ol.arabic {
  list-style-type: decimal;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}

div.compact ul, div.compact ol,
div.compact p, div.compact p,
div.compact div, div.compact div {
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}

tfoot {
  font-weight: bold;
}
td > div.verse {
  white-space: pre;
}

div.hdlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hdlist tr {
  padding-bottom: 15px;
}
dt.hdlist1.strong, td.hdlist1.strong {
  font-weight: bold;
}
td.hdlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
  color: navy;
}
td.hdlist2 {
  vertical-align: top;
}
div.hdlist.compact tr {
  margin: 0;
  padding-bottom: 0;
}

.comment {
  background: yellow;
}

.footnote, .footnoteref {
  font-size: 0.8em;
}

span.footnote, span.footnoteref {
  vertical-align: super;
}

#footnotes {
  margin: 20px 0 20px 0;
  padding: 7px 0 0 0;
}

#footnotes div.footnote {
  margin: 0 0 5px 0;
}

#footnotes hr {
  border: none;
  border-top: 1px solid silver;
  height: 1px;
  text-align: left;
  margin-left: 0;
  width: 20%;
  min-width: 100px;
}

div.colist td {
  padding-right: 0.5em;
  padding-bottom: 0.3em;
  vertical-align: top;
}
div.colist td img {
  margin-top: 0.3em;
}

@media print {
  #footer-badges { display: none; }
}

#toc {
  margin-bottom: 2.5em;
}

#toctitle {
  color: #527bbd;
  font-size: 1.1em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel0, div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 {
  margin-top: 0;
  margin-bottom: 0;
}
div.toclevel2 {
  margin-left: 2em;
  font-size: 0.9em;
}
div.toclevel3 {
  margin-left: 4em;
  font-size: 0.9em;
}
div.toclevel4 {
  margin-left: 6em;
  font-size: 0.9em;
}

span.aqua { color: aqua; }
span.black { color: black; }
span.blue { color: blue; }
span.fuchsia { color: fuchsia; }
span.gray { color: gray; }
span.green { color: green; }
span.lime { color: lime; }
span.maroon { color: maroon; }
span.navy { color: navy; }
span.olive { color: olive; }
span.purple { color: purple; }
span.red { color: red; }
span.silver { color: silver; }
span.teal { color: teal; }
span.white { color: white; }
span.yellow { color: yellow; }

span.aqua-background { background: aqua; }
span.black-background { background: black; }
span.blue-background { background: blue; }
span.fuchsia-background { background: fuchsia; }
span.gray-background { background: gray; }
span.green-background { background: green; }
span.lime-background { background: lime; }
span.maroon-background { background: maroon; }
span.navy-background { background: navy; }
span.olive-background { background: olive; }
span.purple-background { background: purple; }
span.red-background { background: red; }
span.silver-background { background: silver; }
span.teal-background { background: teal; }
span.white-background { background: white; }
span.yellow-background { background: yellow; }

span.big { font-size: 2em; }
span.small { font-size: 0.6em; }

span.underline { text-decoration: underline; }
span.overline { text-decoration: overline; }
span.line-through { text-decoration: line-through; }

div.unbreakable { page-break-inside: avoid; }


/*
 * xhtml11 specific
 *
 * */

div.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.tableblock > table {
  border: 3px solid #527bbd;
}
thead, p.table.header {
  font-weight: bold;
  color: #527bbd;
}
p.table {
  margin-top: 0;
}
/* Because the table frame attribute is overriden by CSS in most browsers. */
div.tableblock > table[frame="void"] {
  border-style: none;
}
div.tableblock > table[frame="hsides"] {
  border-left-style: none;
  border-right-style: none;
}
div.tableblock > table[frame="vsides"] {
  border-top-style: none;
  border-bottom-style: none;
}


/*
 * html5 specific
 *
 * */

table.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
thead, p.tableblock.header {
  font-weight: bold;
  color: #527bbd;
}
p.tableblock {
  margin-top: 0;
}
table.tableblock {
  border-width: 3px;
  border-spacing: 0px;
  border-style: solid;
  border-color: #527bbd;
  border-collapse: collapse;
}
th.tableblock, td.tableblock {
  border-width: 1px;
  padding: 4px;
  border-style: solid;
  border-color: #527bbd;
}

table.tableblock.frame-topbot {
  border-left-style: hidden;
  border-right-style: hidden;
}
table.tableblock.frame-sides {
  border-top-style: hidden;
  border-bottom-style: hidden;
}
table.tableblock.frame-none {
  border-style: hidden;
}

th.tableblock.halign-left, td.tableblock.halign-left {
  text-align: left;
}
th.tableblock.halign-center, td.tableblock.halign-center {
  text-align: center;
}
th.tableblock.halign-right, td.tableblock.halign-right {
  text-align: right;
}

th.tableblock.valign-top, td.tableblock.valign-top {
  vertical-align: top;
}
th.tableblock.valign-middle, td.tableblock.valign-middle {
  vertical-align: middle;
}
th.tableblock.valign-bottom, td.tableblock.valign-bottom {
  vertical-align: bottom;
}


/*
 * manpage specific
 *
 * */

body.manpage h1 {
  padding-top: 0.5em;
  padding-bottom: 0.5em;
  border-top: 2px solid silver;
  border-bottom: 2px solid silver;
}
body.manpage h2 {
  border-style: none;
}
body.manpage div.sectionbody {
  margin-left: 3em;
}

@media print {
  body.manpage div#toc { display: none; }
}


@media screen {
  body {
    max-width: 50em; /* approximately 80 characters wide */
    margin-left: 16em;
  }

  #toc {
    position: fixed;
    top: 0;
    left: 0;
    bottom: 0;
    width: 13em;
    padding: 0.5em;
    padding-bottom: 1.5em;
    margin: 0;
    overflow: auto;
    border-right: 3px solid #f8f8f8;
    background-color: white;
  }

  #toc .toclevel1 {
    margin-top: 0.5em;
  }

  #toc .toclevel2 {
    margin-top: 0.25em;
    display: list-item;
    color: #aaaaaa;
  }

  #toctitle {
    margin-top: 0.5em;
  }
}
</style>
<script type="text/javascript">
/*<![CDATA[*/
var asciidoc = {  // Namespace.

/////////////////////////////////////////////////////////////////////
// Table Of Contents generator
/////////////////////////////////////////////////////////////////////

/* Author: Mihai Bazon, September 2002
 * http://students.infoiasi.ro/~mishoo
 *
 * Table Of Content generator
 * Version: 0.4
 *
 * Feel free to use this script under the terms of the GNU General Public
 * License, as long as you do not remove or alter this notice.
 */

 /* modified by Troy D. Hanson, September 2006. License: GPL */
 /* modified by Stuart Rackham, 2006, 2009. License: GPL */

// toclevels = 1..4.
toc: function (toclevels) {

  function getText(el) {
    var text = "";
    for (var i = el.firstChild; i != null; i = i.nextSibling) {
      if (i.nodeType == 3 /* Node.TEXT_NODE */) // IE doesn't speak constants.
        text += i.data;
      else if (i.firstChild != null)
        text += getText(i);
    }
    return text;
  }

  function TocEntry(el, text, toclevel) {
    this.element = el;
    this.text = text;
    this.toclevel = toclevel;
  }

  function tocEntries(el, toclevels) {
    var result = new Array;
    var re = new RegExp('[hH]([1-'+(toclevels+1)+'])');
    // Function that scans the DOM tree for header elements (the DOM2
    // nodeIterator API would be a better technique but not supported by all
    // browsers).
    var iterate = function (el) {
      for (var i = el.firstChild; i != null; i = i.nextSibling) {
        if (i.nodeType == 1 /* Node.ELEMENT_NODE */) {
          var mo = re.exec(i.tagName);
          if (mo && (i.getAttribute("class") || i.getAttribute("className")) != "float") {
            result[result.length] = new TocEntry(i, getText(i), mo[1]-1);
          }
          iterate(i);
        }
      }
    }
    iterate(el);
    return result;
  }

  var toc = document.getElementById("toc");
  if (!toc) {
    return;
  }

  // Delete existing TOC entries in case we're reloading the TOC.
  var tocEntriesToRemove = [];
  var i;
  for (i = 0; i < toc.childNodes.length; i++) {
    var entry = toc.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div'
     && entry.getAttribute("class")
     && entry.getAttribute("class").match(/^toclevel/))
      tocEntriesToRemove.push(entry);
  }
  for (i = 0; i < tocEntriesToRemove.length; i++) {
    toc.removeChild(tocEntriesToRemove[i]);
  }

  // Rebuild TOC entries.
  var entries = tocEntries(document.getElementById("content"), toclevels);
  for (var i = 0; i < entries.length; ++i) {
    var entry = entries[i];
    if (entry.element.id == "")
      entry.element.id = "_toc_" + i;
    var a = document.createElement("a");
    a.href = "#" + entry.element.id;
    a.appendChild(document.createTextNode(entry.text));
    var div = document.createElement("div");
    div.appendChild(a);
    div.className = "toclevel" + entry.toclevel;
    toc.appendChild(div);
  }
  if (entries.length == 0)
    toc.parentNode.removeChild(toc);
},


/////////////////////////////////////////////////////////////////////
// Footnotes generator
/////////////////////////////////////////////////////////////////////

/* Based on footnote generation code from:
 * http://www.brandspankingnew.net/archive/2005/07/format_footnote.html
 */

footnotes: function () {
  // Delete existing footnote entries in case we're reloading the footnodes.
  var i;
  var noteholder = document.getElementById("footnotes");
  if (!noteholder) {
    return;
  }
  var entriesToRemove = [];
  for (i = 0; i < noteholder.childNodes.length; i++) {
    var entry = noteholder.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div' && entry.getAttribute("class") == "footnote")
      entriesToRemove.push(entry);
  }
  for (i = 0; i < entriesToRemove.length; i++) {
    noteholder.removeChild(entriesToRemove[i]);
  }

  // Rebuild footnote entries.
  var cont = document.getElementById("content");
  var spans = cont.getElementsByTagName("span");
  var refs = {};
  var n = 0;
  for (i=0; i<spans.length; i++) {
    if (spans[i].className == "footnote") {
      n++;
      var note = spans[i].getAttribute("data-note");
      if (!note) {
        // Use [\s\S] in place of . so multi-line matches work.
        // Because JavaScript has no s (dotall) regex flag.
        note = spans[i].innerHTML.match(/\s*\[([\s\S]*)]\s*/)[1];
        spans[i].innerHTML =
          "[<a id='_footnoteref_" + n + "' href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
        spans[i].setAttribute("data-note", note);
      }
      noteholder.innerHTML +=
        "<div class='footnote' id='_footnote_" + n + "'>" +
        "<a href='#_footnoteref_" + n + "' title='Return to text'>" +
        n + "</a>. " + note + "</div>";
      var id =spans[i].getAttribute("id");
      if (id != null) refs["#"+id] = n;
    }
  }
  if (n == 0)
    noteholder.parentNode.removeChild(noteholder);
  else {
    // Process footnoterefs.
    for (i=0; i<spans.length; i++) {
      if (spans[i].className == "footnoteref") {
        var href = spans[i].getElementsByTagName("a")[0].getAttribute("href");
        href = href.match(/#.*/)[0];  // Because IE return full URL.
        n = refs[href];
        spans[i].innerHTML =
          "[<a href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
      }
    }
  }
},

install: function(toclevels) {
  var timerId;

  function reinstall() {
    asciidoc.footnotes();
    if (toclevels) {
      asciidoc.toc(toclevels);
    }
  }

  function reinstallAndRemoveTimer() {
    clearInterval(timerId);
    reinstall();
  }

  timerId = setInterval(reinstall, 500);
  if (document.addEventListener)
    document.addEventListener("DOMContentLoaded", reinstallAndRemoveTimer, false);
  else
    window.onload = reinstallAndRemoveTimer;
}

}
asciidoc.install(4);
/*]]>*/
</script>
</head>
<body class="article">
<div id="header">
<h1>Debug / Troubleshooting / Investigations</h1>
<span id="author">KiwiHC16</span><br />
<div id="toc">
  <div id="toctitle">Table des matières</div>
  <noscript><p><b>JavaScript must be enabled in your browser to display the table of contents.</b></p></noscript>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_home">1. Home</h2>
<div class="sectionbody">
<div class="paragraph"><p>Retour au <a href="index.html">document principal</a>.</p></div>
<div class="paragraph"><p>Je vais essayer de consolider ici tous les retours d&#8217;expériences et les vérifications à faire pour résoudre un éventuel problème.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_forum">2. Forum</h2>
<div class="sectionbody">
<div class="ulist"><ul>
<li>
<p>
Liste des sujets en cours de discussions: <a href="https://www.Jeedom.com/forum/viewtopic.php?f=59&amp;t=33573&amp;hilit=Abeille">Forum</a>
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect1">
<h2 id="_investigations">3. Investigations</h2>
<div class="sectionbody">
<div class="ulist"><ul>
<li>
<p>
Liste des sujets en investigations : <a href="https://github.com/KiwiHC16/Abeille/issues?utf8=✓&amp;q=is%3Aissue">Issues sous GitHub</a>
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect1">
<h2 id="_problèmes">4. Problèmes</h2>
<div class="sectionbody">
<div class="paragraph"><p>Si vous trouvez un problème qui demande une correction dans le plugin, merci d ouvrir <a href="https://github.com/KiwiHC16/Abeille/issues">une "issue" dans GitHub</a></p></div>
<div class="paragraph"><p>Si vous ouvrez une "issue" merci de fournir le plus d&#8217;information possible et en particulier:</p></div>
<div class="ulist"><ul>
<li>
<p>
Votre configuration Jeedom:
</p>
<div class="ulist"><ul>
<li>
<p>
Le HW sur lequel vous faite tourner le plugin,
</p>
</li>
<li>
<p>
la Version de l&#8217;OS,
</p>
</li>
<li>
<p>
la version de Jeedom
</p>
</li>
<li>
<p>
&#8230;
</p>
</li>
</ul></div>
</li>
<li>
<p>
Votre configuration Gateway
</p>
<div class="ulist"><ul>
<li>
<p>
Type de Zigate
</p>
</li>
<li>
<p>
quel firmware
</p>
</li>
<li>
<p>
&#8230;
</p>
</li>
</ul></div>
</li>
<li>
<p>
Les logs, aussi nombreux que possibles surtout
</p>
<div class="ulist"><ul>
<li>
<p>
AbeilleParser
</p>
</li>
<li>
<p>
AbeilleMQTT
</p>
</li>
<li>
<p>
Abeille
*&#8230;
</p>
</li>
</ul></div>
</li>
<li>
<p>
Description
</p>
<div class="ulist"><ul>
<li>
<p>
ce que vous cherchez à faire
</p>
</li>
<li>
<p>
les résultats
</p>
</li>
<li>
<p>
captures d&#8217;ecrans
</p>
</li>
<li>
<p>
&#8230;
</p>
</li>
</ul></div>
</li>
</ul></div>
</div>
</div>
<div class="sect1">
<h2 id="_evolution">5. Evolution</h2>
<div class="sectionbody">
<div class="paragraph"><p>Si vous souhaitez une évolution dans le plugin, merci d ouvrir une "issue" dans GitHub à l&#8217;adresse avec un "Labels" "enhancement": <a href="https://github.com/KiwiHC16/Abeille/issues">https://github.com/KiwiHC16/Abeille/issues</a></p></div>
</div>
</div>
<div class="sect1">
<h2 id="_debug">6. Debug</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_retain_dans_les_objets">6.1. "retain" dans les objets</h3>
<div class="ulist"><ul>
<li>
<p>
Ce plugin utilise un broker MQTT qui a une fonction spécifique "retain".
</p>
</li>
<li>
<p>
Le plugin <span class="underline">n&#8217;utilise pas</span> ce mode de fonctionnement.
</p>
</li>
<li>
<p>
<span class="underline">Il est fortement conseillé de ne pas choisir "retain"</span> si vous ne comprenez pas les conséquences.
</p>
</li>
<li>
<p>
L&#8217;option reste accessible pour les pros de MQTT. Si jamais vous voulez l&#8217;utiliser alors allez voir <a href="https://www.hivemq.com/blog/mqtt-essentials-part-8-retained-messages">https://www.hivemq.com/blog/mqtt-essentials-part-8-retained-messages</a> .
</p>
</li>
<li>
<p>
Normalement vous ne devriez pas avoir accès à cette propriété par défaut car je l&#8217;ai enlevé des commandes.
</p>
</li>
<li>
<p>
Si vous avez par erreur activé un "retain" et que le comportement du plugin est impacté, vous pouvez faire la manipulation suivante:
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="content">
<pre><code>rm /var/lib/mosquitto/mosquitto.db <img src="../images/icons/callouts/1.png" alt="1" />
apt-get remove mosquitto <img src="../images/icons/callouts/2.png" alt="2" />
apt-get install mosquitto <img src="../images/icons/callouts/3.png" alt="3" /></code></pre>
</div></div>
<div class="colist arabic"><table>
<tr><td><img src="../images/icons/callouts/1.png" alt="1" /></td><td>
Effacons la base de données contenant les informations relative aux messages "retain".
</td></tr>
<tr><td><img src="../images/icons/callouts/2.png" alt="2" /></td><td>
Enlevons mosquitto du systeme
</td></tr>
<tr><td><img src="../images/icons/callouts/3.png" alt="3" /></td><td>
Installons de nouveau mosquitto sur le systeme.
</td></tr>
</table></div>
</div>
<div class="sect2">
<h3 id="_configuration">6.2. Configuration</h3>
<div class="ulist"><ul>
<li>
<p>
Verifier la configuration réseau et en particulier /hostname, /etc/hosts
</p>
</li>
<li>
<p>
Vérifier la configuration du plugin. Par exemple le message suivant indique très probablement que l&#8217;objet de rattachement de l'équipement Ruche n&#8217;est pas défini.
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="content">
<pre><code>[MySQL] Error code : 23000 (1452). Cannot add or update a child row: a foreign key constraint fails (`Jeedom`.`eqLogic`, CONSTRAINT `fk_eqLogic_object1` FOREIGN KEY (`object_id`) REFERENCES `object` (`id`) ON DELETE SET NULL ON UPDATE CASCADE)</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_connection">6.3. Connection</h3>
<div class="sect3">
<h4 id="_premier_test">6.3.1. Premier test</h4>
<div class="ulist"><ul>
<li>
<p>
Rendez l équipement Ruche Visible (Il est maintenant caché par défaut).
</p>
</li>
<li>
<p>
Dans l équipement ruche, appuyez sur le bouton "Version", vous devez récupérer la version logicielle dans le champ SW, la version de dev dans le champ SDK et les dates Last et Lasts Stamps doivent se mettre à jour à chaque fois. Si les dates se mettent à jour c&#8217;est que le dialogue Abeille-Zigate fonctionne dans les deux sens.
</p>
</li>
</ul></div>
</div>
<div class="sect3">
<h4 id="_deuxième_test">6.3.2. Deuxième test</h4>
<div class="ulist"><ul>
<li>
<p>
Vérifiez bien que vous n&#8217;avez pas plusieurs Plugins essayant d&#8217;utiliser le même port série (/dev/ttyUSBx).
</p>
</li>
</ul></div>
</div>
<div class="sect3">
<h4 id="_troisième_test">6.3.3. Troisième test</h4>
<div class="ulist"><ul>
<li>
<p>
Tester la Zigate en ligne de commande
</p>
</li>
</ul></div>
<div class="paragraph"><p>On envoie</p></div>
<div class="listingblock">
<div class="content">
<pre><code>stty -F/dev/ttyUSB0 115200 <img src="../images/icons/callouts/1.png" alt="1" />
echo -ne '\x01\x02\x10\x49\x02\x10\x02\x14\xb0\xff\xfc\xfe\x02\x10\x03' &gt; /dev/ttyUSB0 <img src="../images/icons/callouts/2.png" alt="2" /></code></pre>
</div></div>
<div class="colist arabic"><table>
<tr><td><img src="../images/icons/callouts/1.png" alt="1" /></td><td>
On configure le port série
</td></tr>
<tr><td><img src="../images/icons/callouts/2.png" alt="2" /></td><td>
On demande à la zigate de se mettre en inclusion.
</td></tr>
</table></div>
<div class="paragraph"><p>(Cela peut être fait alors que le plugin est Zigate fonctionnent).</p></div>
<div class="paragraph"><p>Cette commande demande à la Zigate de se mettre en Inclusion, vous devriez voir la LED bleu se mettre à clignoter et dans le log AbeilleParser vous devriez voir passer un message comme:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>AbeilleParser 2018-02-28 04:21:32[DEBUG]-------------- 2018-02-28 04:21:32: protocolData size(20) message &gt; 12 char
AbeilleParser 2018-02-28 04:21:32[DEBUG]Type: 8000 quality: 00
AbeilleParser 2018-02-28 04:21:32[DEBUG]type: 8000 (Status)(Not Processed)
AbeilleParser 2018-02-28 04:21:32[DEBUG]Length: 5
AbeilleParser 2018-02-28 04:21:32[DEBUG]Status: 00-(Success)
AbeilleParser 2018-02-28 04:21:32[DEBUG]SQN: b8</code></pre>
</div></div>
<div class="paragraph"><p>Si la LED bleue clignote cela confirme que le dialogue Abeille vers Zigate fonctionne.</p></div>
<div class="paragraph"><p>PS: la configuration du port peu varier d&#8217;un système à l&#8217;autre donc il peut être nécesaire de jouer avec stty en rajoutant les arguments raw, cs8, -parenb et autres.</p></div>
</div>
<div class="sect3">
<h4 id="_quatrième_test">6.3.4. Quatrième test</h4>
<div class="paragraph"><p>Arretez le plugin Abeille. Lancer la commande dans un terminal (Ecoute):</p></div>
<div class="listingblock">
<div class="content">
<pre><code>cat /dev/ttyUSB0 | hexdump -vC</code></pre>
</div></div>
<div class="paragraph"><p>Dans un second terminal envoiyez la commande</p></div>
<div class="listingblock">
<div class="content">
<pre><code>stty -F/dev/ttyUSB0 115200
echo -ne '\x01\x02\x10\x49\x02\x10\x02\x14\xb0\xff\xfc\xfe\x02\x10\x03' &gt; /dev/ttyUSB0</code></pre>
</div></div>
<div class="paragraph"><p>Dans le premier terminal (Ecoute) vous devriez voir passer du traffic comme:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>www-data@Abeille:~/html/log$ cat /dev/ttyUSB0 | hexdump -vC
00000000  01 80 02 10 02 10 02 15  77 02 10 bb 02 10 49 02  |........w.....I.|
00000010  10 03 01 80 02 10 02 10  02 15 70 02 10 bc 02 10  |..........p.....|</code></pre>
</div></div>
<div class="paragraph"><p>Cela confirme Zigate vers Jeedom</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_mosquitto">6.4. Mosquitto</h3>
<div class="ulist"><ul>
<li>
<p>
Abeille utilise un broker mosquitto pour échanger des messages entre les modules logicielles.
</p>
</li>
<li>
<p>
mosquitto est installé sur la machine par défaut lors de l&#8217;installation des dépendances, vous pouvez utiliser un autre broker, sur une autre machine si vous le souhaitez (pas testé)
</p>
</li>
</ul></div>
<div class="sect3">
<h4 id="_configuration_2">6.4.1. Configuration</h4>
<div class="ulist"><ul>
<li>
<p>
La configuration générale du plugin propose les paramètres :
</p>
<div class="ulist"><ul>
<li>
<p>
Adresse du broker Mosquitto (peut être présent ailleurs sur le réseau)
</p>
</li>
<li>
<p>
Port du serveur Mosquitto (1883 par défaut)
</p>
</li>
<li>
<p>
Identifiant de Jeedom avec lequel il publiera sur le broker
</p>
</li>
<li>
<p>
Il est possible d&#8217;ajouter un compte et mot de passe si la connexion le requiert.
</p>
</li>
<li>
<p>
QoS à utiliser (par défaut 0).
</p>
</li>
</ul></div>
</li>
</ul></div>
</div>
<div class="sect3">
<h4 id="_fonctionne">6.4.2. Fonctionne</h4>
<div class="ulist"><ul>
<li>
<p>
Dans santé vous avez le plugin en alerte car mosquitto ne repond pas.
</p>
<div class="ulist"><ul>
<li>
<p>
Faites un <em>ps -ef | grep mosquitto</em> pour voir si le process tourne.
</p>
</li>
<li>
<p>
Lancez à la main mosquitto; Juste <em>mosquitto</em> en ligne de commande.
</p>
</li>
<li>
<p>
Lancez à la main mosquitto avec votre fichier de configuration en ligne de commande: <em>mosquitto -c /etc/mosquitto/mosquitto.conf</em> (Corrigez les erreurs si il y a).
</p>
</li>
<li>
<p>
Experience: après coupure de courant:
</p>
</li>
</ul></div>
</li>
</ul></div>
<div class="listingblock">
<div class="content">
<pre><code>mosquitto -c /etc/mosquitto/mosquitto.conf
1516788158: Error: Success.
1516788158: Error: Couldn't open database.</code></pre>
</div></div>
<div class="paragraph"><p>la solution a été de supprimer la base de donnée et de réinstaller mosquitto:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>rm /var/lib/mosquitto/mosquitto.db
apt-get remove mosquitto
apt-get install mosquitto</code></pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_monitorer">6.4.3. Monitorer</h4>
<div class="paragraph"><p>Monitorer les messages</p></div>
<div class="listingblock">
<div class="content">
<pre><code>mosquitto_sub -t "=" -v</code></pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_installation_manuelle">6.4.4. Installation Manuelle</h4>
<div class="paragraph"><p>Soyez root ou en mode sudo.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>cd /root
apt-get -y update
apt-get -y upgrade

apt-get -y install php
apt-get -y install mosquitto
apt-get -y install libmosquitto-dev
apt-get -y install git
apt-get -y install php7.0-dev

mkdir Mosquitto-PHP
cd Mosquitto-PHP
git clone https://github.com/mgdm/Mosquitto-PHP.git
cd Mosquitto-PHP
phpize
./configure
make
make install</code></pre>
</div></div>
<div class="paragraph"><p>Ajouter extension=mosquitto.so à la fin du fichier php.ini
(par exemple /etc/php/7.0/apache2/php.ini")
Vous pouvez trouver les fichiers php.ini avec la commande:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>find /etc -name php.ini -print</code></pre>
</div></div>
<div class="paragraph"><p>Redemarrer tout le monde</p></div>
<div class="listingblock">
<div class="content">
<pre><code>/etc/init.d/mosquitto restart
/etc/init.d/apapche2 restart</code></pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_re_installation">6.4.5. Re-Installation</h4>
<div class="ulist"><ul>
<li>
<p>
Debian 8 sur VM
</p>
<div class="ulist"><ul>
<li>
<p>
Je viens d&#8217;installer le plugin Abeille sur une Debian 8 en VM x86 64.
</p>
</li>
<li>
<p>
Impossible de lancer le demon.
</p>
</li>
<li>
<p>
Même un /etc/init.d/mosquitto start à la main ne fonctionne pas.
</p>
</li>
<li>
<p>
Après des recherches infructueuse je suis passé par synaptic (ssh <a href="mailto:root@machine">root@machine</a> -Y) et fait "reinstallé" de tous les modules mosquitto. Et maintenant cela fonctionne.
</p>
</li>
</ul></div>
</li>
</ul></div>
</div>
</div>
<div class="sect2">
<h3 id="_equipements_zigbee">6.5. Equipements ZigBee</h3>
<div class="paragraph"><p>La ruche possede des commandes pour interroger les objets. Les deux principales sont ActiveEndPoint et SingleDescriptorRequest.</p></div>
<div class="paragraph"><p><span class="image">
<img src="../images/Capture_d_ecran_2018_02_06_a_17_33_19.png" alt="Capture_d_ecran_2018_02_06_a_17_33_19.png" />
</span></p></div>
<div class="paragraph"><p>Dans ActiveEndPoint mettre l&#8217;adresse de l'équipement dans le titre puis clic sur le bouton ActiveEndPoint.</p></div>
<div class="paragraph"><p>Regardez dans la log AbeilleParser, vous devez voir passer la réponse. Par exemple pour une ampoule IKEA:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>AbeilleParser: 2018-02-06 17:40:16[DEBUG]-------------- 2018-02-06 17:40:16: protocolData
AbeilleParser: 2018-02-06 17:40:16[DEBUG]message &gt; 12 char
AbeilleParser: 2018-02-06 17:40:16[DEBUG]Type: 8045 quality: 93
AbeilleParser: 2018-02-06 17:40:16[DEBUG]type: 8045 (Active Endpoints Response)(Not Processed)
AbeilleParser: 2018-02-06 17:40:16[DEBUG]SQN : da
AbeilleParser: 2018-02-06 17:40:16[DEBUG]Status : 00
AbeilleParser: 2018-02-06 17:40:16[DEBUG]Short Address : 6e1b
AbeilleParser: 2018-02-06 17:40:16[DEBUG]Endpoint Count : 01
AbeilleParser: 2018-02-06 17:40:16[DEBUG]Endpoint List :
AbeilleParser: 2018-02-06 17:40:16[DEBUG]Endpoint : 01</code></pre>
</div></div>
<div class="paragraph"><p>Il y a, dans ce cas, une seul EndPoint à l&#8217;adresse "01" (Donné par les lignes suivant "Endpoint List").</p></div>
<div class="paragraph"><p>Faire de même pour SingleDescriptorRequest en ajoutant le EndPoint voulu dans le champ Message.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>AbeilleParser: 2018-02-06 17:42:25[DEBUG]-------------- 2018-02-06 17:42:25: protocolData
AbeilleParser: 2018-02-06 17:42:25[DEBUG]message &gt; 12 char
AbeilleParser: 2018-02-06 17:42:25[DEBUG]Type: 8000 quality: 00
AbeilleParser: 2018-02-06 17:42:25[DEBUG]type: 8000 (Status)(Not Processed)
AbeilleParser: 2018-02-06 17:42:25[DEBUG]Length: 5
AbeilleParser: 2018-02-06 17:42:25[DEBUG]Status: 00-(Success)
AbeilleParser: 2018-02-06 17:42:25[DEBUG]SQN: db
AbeilleParser: 2018-02-06 17:42:25[DEBUG]-------------- 2018-02-06 17:42:25: protocolData
AbeilleParser: 2018-02-06 17:42:25[DEBUG]message &gt; 12 char
AbeilleParser: 2018-02-06 17:42:25[DEBUG]Type: 8043 quality: 93
AbeilleParser: 2018-02-06 17:42:25[DEBUG]Type: 8043 (Simple Descriptor Response)(Not Processed)
AbeilleParser: 2018-02-06 17:42:25[DEBUG]SQN : db
AbeilleParser: 2018-02-06 17:42:25[DEBUG]Status : 00
AbeilleParser: 2018-02-06 17:42:25[DEBUG]Short Address : 6e1b
AbeilleParser: 2018-02-06 17:42:25[DEBUG]Length : 20
AbeilleParser: 2018-02-06 17:42:25[DEBUG]endpoint : 01
AbeilleParser: 2018-02-06 17:42:25[DEBUG]profile : c05e
AbeilleParser: 2018-02-06 17:42:25[DEBUG]deviceId : 0100
AbeilleParser: 2018-02-06 17:42:25[DEBUG]bitField : 02
AbeilleParser: 2018-02-06 17:42:25[DEBUG]InClusterCount : 08
AbeilleParser: 2018-02-06 17:42:25[DEBUG]In cluster: 0000 - General: Basic
AbeilleParser: 2018-02-06 17:42:25[DEBUG]In cluster: 0003 - General: Identify
AbeilleParser: 2018-02-06 17:42:25[DEBUG]In cluster: 0004 - General: Groups
AbeilleParser: 2018-02-06 17:42:25[DEBUG]In cluster: 0005 - General: Scenes
AbeilleParser: 2018-02-06 17:42:25[DEBUG]In cluster: 0006 - General: On/Off
AbeilleParser: 2018-02-06 17:42:25[DEBUG]In cluster: 0008 - General: Level Control
AbeilleParser: 2018-02-06 17:42:25[DEBUG]In cluster: 0B05 - Misc: Diagnostics
AbeilleParser: 2018-02-06 17:42:25[DEBUG]In cluster: 1000 - ZLL: Commissioning
AbeilleParser: 2018-02-06 17:42:25[DEBUG]OutClusterCount : 04
AbeilleParser: 2018-02-06 17:42:25[DEBUG]Out cluster: 0000 - General: Basic
AbeilleParser: 2018-02-06 17:42:25[DEBUG]Out cluster: 0003 - General: Identify
AbeilleParser: 2018-02-06 17:42:25[DEBUG]Out cluster: 0004 - General: Groups
AbeilleParser: 2018-02-06 17:42:25[DEBUG]Out cluster: 0005 - General: Scenes</code></pre>
</div></div>
<div class="paragraph"><p>Nous avons maintenant les clusters supportés par cet objet sur son endpoint 01.</p></div>
</div>
<div class="sect2">
<h3 id="_script">6.6. Script</h3>
<div class="paragraph"><p>Dans Abeille/resources/AbeilleDeamon/Debug, vous trouverez le script verification.sh.
L&#8217;execution permet de tester, vérifier et donner des infos qui sont souvent interessantes pour des problème de base. Ce script n&#8217;est pas forcement bien maintenu alors les résultats ne sont pas forcement fiables.</p></div>
</div>
</div>
</div>
</div>
<div id="footnotes"><hr /></div>
<div id="footer">
<div id="footer-text">
Last updated
 2019-04-04 11:32:12 CEST
</div>
</div>
</body>
</html>
