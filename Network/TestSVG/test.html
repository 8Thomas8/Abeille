<html>
    <head>
    </head>
    
    <body>
        <p id="position"></p>
        
        <script type="text/javascript">
            function makeDraggable(evt) {
                var svg = evt.target;
                svg.addEventListener('mousedown',   startDrag, false);
                svg.addEventListener('mousemove',   drag, false);
                svg.addEventListener('mouseup',     endDrag, false);
                svg.addEventListener('mouseleave',  endDrag);
                
                function getMousePosition(evt) {
                    var CTM = svg.getScreenCTM();
                    return {
                        x: (evt.clientX - CTM.e) / CTM.a,
                        y: (evt.clientY - CTM.f) / CTM.d
                    };
                }
                
                var selectedElement, offset, transform;
                var positionX = "Position: X=";
                var positionY = " Y=";
                var X = 0;
                var Y = 0;
                
                function startDrag(evt) {
                    if (evt.target.classList.contains('draggable')) {
                        selectedElement = evt.target;
                        offset = getMousePosition(evt);
                        
                        // Make sure the first transform on the element is a translate transform
                        var transforms = selectedElement.transform.baseVal;
                        
                        if (transforms.length === 0 || transforms.getItem(0).type !== SVGTransform.SVG_TRANSFORM_TRANSLATE) {
                            // Create an transform that translates by (0, 0)
                            var translate = svg.createSVGTransform();
                            translate.setTranslate(0, 0);
                            selectedElement.transform.baseVal.insertItemBefore(translate, 0);
                        }
                        
                        // Get initial translation
                        transform = transforms.getItem(0);
                        offset.x -= transform.matrix.e;
                        offset.y -= transform.matrix.f;
                    }
                }
                
                function drag(evt) {
                    if (selectedElement) {
                        evt.preventDefault();
                        var coord = getMousePosition(evt);
                        transform.setTranslate(coord.x - offset.x, coord.y - offset.y);
                    }
                }
                
                function endDrag(evt) {
                    if (selectedElement) {
                        evt.preventDefault();
                        var coord = getMousePosition(evt);
                        transform.setTranslate(coord.x - offset.x, coord.y - offset.y);
                    }
                    X = coord.x - offset.x;
                    Y = coord.y - offset.y;
                    document.getElementById("position").innerHTML = positionX + X + positionY + Y;
                    selectedElement = false;
                    
                }
            }
        </script>
        
        <script type="text/javascript">
            
           var myJSON = '{ "aaaa": { "name": "Door", "x": 200, "y": 200 }, "bbbb": { "name": "Window", "x": 800, "y": 800 } }';
           var myObj = JSON.parse(myJSON);
           // document.write( myObj["aaaa"].name );
           
           document.write( "<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"1100px\" height=\"1100px\" onload=\"makeDraggable(evt)\">" );
           
           for (shortAddress in myObj) {
               // document.write( myObj[x].name );
               // document.write( "<rect class=\"draggable\"     x=\""+myObj[shortAddress].x+"\"   y=\""+myObj[shortAddress].y+"\" width=\"8\"     height=\"10\"     fill=\"#007bff\"  transform=\"translate(10, 0)\"></rect>" );
               document.write( "<circle class=\"draggable\"   cx=\""+myObj[shortAddress].x+"\"  cy=\""+myObj[shortAddress].y+"\"              r=\"10\"           fill=\"#DEDEDE\"  transform=\"translate(10, 0)\"></circle>" );
           }
        
            // Dessine la legende
            document.write( '<circle cx="100" cy="900" r="10" fill="green" />\n' );
            document.write( '<a xlink:href="/index.php?v=d&m=Abeille&p=Abeille" target="_blank"> <text x="110" y="900" fill="red" style="font-size: 8px;">Battery</text> </a>\n' );
            
            document.write( '<circle cx="100" cy="925" r="10" fill="orange" />\n' );
            document.write( '<a xlink:href="/index.php?v=d&m=Abeille&p=Abeille" target="_blank"> <text x="110" y="925" fill="red" style="font-size: 8px;">Routeur</a>\n' );
            
            document.write( '<circle cx="100" cy="950" r="10" fill="red" />\n' );
            document.write( '<a xlink:href="/index.php?v=d&m=Abeille&p=Abeille" target="_blank"> <text x="110" y="950" fill="red" style="font-size: 8px;">Inconnu par Jeedom</text> </a>\n' );

            document.write( "</svg>" );
        </script>
        
    </body>
</html>
